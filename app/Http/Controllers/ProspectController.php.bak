<?php

namespace App\Http\Controllers;

use App\Models\JobTitle;
use Illuminate\Http\Request;
use App\Models\Prospect;
use Illuminate\Support\Facades\DB;
use Exception;

class ProspectController extends Controller
{
    public function prospectList(Request $request)
    {
        if($request->ajax())
        {
<<<<<<< HEAD
            $prospects =  Prospect::where('status',1)->get();
=======
            $prospects =  Prospect::where('status',1)->where('prospect_type',1)->get();

>>>>>>> 1738ed69bcd669205d9df2325e92353fc6be3c2e
            return view('selling.prospect.prospectListAjax',compact('prospects'));
        }
        return view('selling.prospect.prospectList');
    }
    public function createProspect ()
    {
        return view('selling.prospect.createProspect');
    }   

    public function prospectStore(Request $request)
    {
        
    DB::Connection('mysql2')->beginTransaction();
        try {

        $prospect = new  Prospect;
        $prospect->contact_id  = $request->contact_id;
        $prospect->company_name  = $request->company_name;
        $prospect->company_address  = $request->company_Address;
        $prospect->company_location_id  = $request->company_location;
        $prospect->customer_group_id  = $request->company_group;
        $prospect->save();
        DB::Connection('mysql2')->commit();
    }
    catch (Exception $e) {
        DB::Connection('mysql2')->rollBack();
        return response()->json(['error' => $e->getMessage()]);
    }
    return response()->json(['success' => 'successfully Added .']);


    }

    public function viewProspect(Request $request) {
        $prospect = Prospect::with('contact', 'companyLocation', 'companyGroup')->where([['id','=', $request->id],['status','=', 1]])->first();
        return view('selling.prospect.viewProspect', compact('prospect'));
    }
    public function createJobtitle(Request $request)
    {
        return view('selling.prospect.createJobtitle');
    }

    public function JobtitleStore(Request $request)
    {
        DB::Connection('mysql2')->beginTransaction();
        try {
                    $job = new JobTitle();
                    $job->name = $request->name;
                    $job->save();
       DB::Connection('mysql2')->commit();
    }
    catch (Exception $e) {
        DB::Connection('mysql2')->rollBack();
        return response()->json(['error' => $e->getMessage()]);
    }
    return response()->json(['success' => 'successfully Added .']);
    }
    public function getJobtitle(Request $request)
    {
      $data = JobTitle::where('status',1)->get();
      return $data;
    }
}
